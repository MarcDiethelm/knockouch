<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="css/iphone.css" rel="stylesheet" />
    <link href="css/animate.css" rel="stylesheet" />

    <script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"></script>
    <script src="../libs/hammer.js"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="../src/knockouch.js"></script>    
</head>
<body>
    <div class='iphone'>
        <div class='steel_band'>
            <div class='mute_rocker'></div>
            <div class='volume up'></div>
            <div class='volume down'></div>
            <div class='sleep_wake'></div>
            <div class='plastic_band'>
                <div class='glass_face'>
                    <div class='camera'></div>
                    <div class='speaker'></div>
                    <div class='home_button' data-bind="tap:cancel"></div>
                    <div class='screen' data-bind="swipeleft:prev, swiperight:next">
                        <div class='stage' >
                            <div class="screen-slides" data-bind="foreach: screens">
                                <span class="screen-slide" data-bind="foreach: $root.icons">
                                    <span data-bind="css: name, hold: $root.holdIcons" ></span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function Icon(name, text) {
            this.name = ko.observable(name || 'icon');
            this.text = text || 'test';
        }
        
        var iPhone = (function() {
            var isHolding = ko.observable(false);
            var screens = ko.observableArray([1, 2, 3]);
            var icons = ko.observableArray([new Icon(), new Icon(), new Icon(), new Icon(), new Icon(), new Icon(), new Icon(), new Icon(), new Icon()]);
            
            function holdIcons() {
                //TODO: set every icon class to holded. we can also make it for some top level container.
                isHolding(!isHolding());
                var iconsArr = icons();
                for (var i = 0; i < iconsArr.length; i++) {
                    var iconClass = isHolding() ? 'icon shake' : 'icon';
                    iconsArr[i].name(iconClass);
                }
                
                icons(iconsArr);                
            };
            
            function cancel() {
                if (isHolding()) {
                    holdIcons();//hold once again to cancel hold.
                }
            };
            
            function next() {                
                addIconClass('moveOutRight moveInLeft');
            }

            function prev() {
                //TODO: switch to the previous page if any.
                addIconClass('moveInRight');
            }

            return {
                isHolding: isHolding,
                screens:screens,
                icons: icons,
                holdIcons: holdIcons,
                cancel: cancel,
                next:next,
                prev: prev,
                addIconClass: addIconClass
            };
        }());
        
        ko.applyBindings(iPhone);
        $(function () {
            $(".icon").bind("webkitAnimationEnd oTransitionEnd otransitionend transitionend msTransitionEnd", function () {
                console.log('ended');
            });
        });
        
    </script>
</body>
</html>
