<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="../libs/three.min.js"></script>
    <script src="../libs/knockout-2.2.1.js"></script>
    <script src="../libs/hammer.js"></script>
    <script src="../src/knockouch.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <title></title>
    <style>
    </style>
</head>
<body data-bind="drag: rotate, dragend: endRotate">
</body>
</html>

<script>
    knockouch("Hammer", { drag_min_distance: 0 });

    function CubeViewModel() {
        var self = this;
        var camera, scene, renderer,
            geometry, material, mesh,
            rotateX = 0, rotateY = 0,
            endRotateX = 0, endRotateY = 0;

        self.init = function () {
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 10000);
            camera.position.z = 1000;

            scene = new THREE.Scene();

            geometry = new THREE.CubeGeometry(400, 400, 400);
            material = new THREE.MeshBasicMaterial({ color: 0xff0000, wireframe: true });

            mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);

            renderer = new THREE.CanvasRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);

            document.body.appendChild(renderer.domElement);

            self.animate();
        };
        self.animate = function () {
            requestAnimationFrame(self.animate);

            mesh.rotation.x = rotateX;
            mesh.rotation.y = rotateY;

            renderer.render(scene, camera);
        };
        self.rotate = function (ev) {
            rotateX = ev.gesture.deltaY / 200 + endRotateX;
            rotateY = ev.gesture.deltaX / 200 + endRotateY;
        };
        self.endRotate = function () {
            endRotateX = rotateX;
            endRotateY = rotateY;
        };

        self.init();
    }

    ko.applyBindings(new CubeViewModel());

</script>
